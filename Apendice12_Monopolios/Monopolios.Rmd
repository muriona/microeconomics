---
title: "Monopólios"
subtitle: "Apêndice - Aula 12"
author: "Prof. Mauricio Uriona Maldonado"
institute: "EPS 5222"
date: "`r format(Sys.Date(), '%d/%m/%Y')`"
output:
  xaringan::moon_reader:
    self_contained: true
    lib_dir: libs
    css: ["default", "rladies", "rladies-fonts"]
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---


```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE,
        echo = FALSE, message = FALSE, warning = FALSE)
```

```{r xaringan-themer, include=FALSE, warning = FALSE}
library(xaringanthemer)
style_mono_accent(
  base_color = "#e32d91",
  header_font_google=google_font("Montserrat"),
  text_font_google=google_font("Source Sans Pro"),
  text_font_size = "24px"
)
```

# Função de Demanda e Função de Receita

- Vamos construir algumas funções de custo e receita. Vamos assumir que a função de demanda seja $Q = 40 - P$, isto significa que rearranjando os termos, a função de demanda seria igual a $P = 40 - Q$

- A Receita Total será portanto $R = 40Q - Q^2$ pois a  $\frac{d}{dQ} 40Q - Q^2 = 40 - Q$ e a Função de Custo Total será $C = 50 + Q^2$

- E Lucro será igual a $L = R - C$

```{r echo = FALSE, warning=FALSE, message = FALSE}
library(tidyverse)
library(Deriv)
library(directlabels)
library(cowplot) # for arranging plots
library(DT)

demanda <- function(q) 40 - q
receita <- function(q) (40*q) - q^2
custo <- function(q) 50 + q^2
lucro <- function(q) (40*q) - q^2 - 50 - q^2

```

---

# Graficando a Função de Demanda:

```{r demanda, echo = FALSE, warning=FALSE, message = FALSE, fig.width=8, fig.height=4, dpi = 300}

dados <- data.frame(q=seq(from=0, to=20, by=0.1))


dados <- dados %>% 
  mutate(D = demanda(q)) 

dados %>% 
  ggplot(aes(q, D))+
  geom_line(size=1.2, color="#e32d91")+
  theme_bw()+
  labs(y="Preço (R$)", x="Quantidade (milhares de unidades)")

```

---

# Graficando CT, RT e L 

Note que o eixo "y" está em milhares:

```{r, echo = FALSE, warning=FALSE, message = FALSE, fig.width=8, fig.height=4, dpi =300}
library(wesanderson)
dados %>% 
  mutate(CT = custo(q),
         RT = receita(q),
         L = lucro(q)) %>% 
  select(-D) %>% 
  pivot_longer(-q,names_to = "Variaveis", values_to="Valor") %>% 
  ggplot(aes(q, Valor, color = Variaveis))+
  geom_line(size = 1.2)+
  scale_color_manual(values = wes_palette("GrandBudapest1"))+
  geom_dl(aes(label = Variaveis), method = "smart.grid")+
  labs(x="Quantidade (milhares de unidades)", y="Milhares de R$")+
  theme_bw()+
    theme(legend.position = "none")
```

---

# RMg e CMg e CMe

Agora vamos calcular a RMg e CMg:

- Como RMg é $\frac{d}{dQ}R$ então, $RMg = 40 - 2Q$

- Da mesma forma, CMg é $\frac{d}{dQ}C$ então, $CMg = 2Q$

- CMe será igual a $\frac{C}{Q}$  ou seja $CMe = \frac{50}{Q} + Q$

---

# RMg e CMg e CMe

```{r , echo = FALSE, warning=FALSE, message = FALSE}
RMg <- Deriv(receita, "q")

CMg <- Deriv(custo, "q")

CMe <- function(q) 50/q + q

RMe <- function(q) receita(q)/q

dados <- dados %>% 
  mutate(CMg = CMg(q),
         RMg = RMg(q),
         CMe = round(CMe(q),1)) 

datatable(dados, options = list(
  initComplete = JS(
    "function(settings, json) {",
    "$(this.api().table().header()).css({'font-size': '15px', 'background-color': '#d32e91', 'color': '#fff'});",
    "}"))) %>%  formatStyle(columns = colnames(.$x$data), `font-size` = '12px')
```

---

# 

Agora vamos graficar:

```{r dpi = 300, fig.width=8, fig.height=4, echo = FALSE, warning=FALSE, message = FALSE}

plot <- dados %>% 
  pivot_longer(-q, names_to = "Variaveis", values_to="Valor") %>% 
  ggplot(aes(q,Valor, color=Variaveis))+
  geom_line(size=1.2)+
  scale_color_manual(values = wes_palette("Cavalcanti1"))+
  geom_dl(aes(label = Variaveis), method = "smart.grid")+
  labs(x="Quantidade (milhares de unidades)", y="R$")+
  theme_bw()+
    theme(legend.position = "none")+
  scale_y_continuous(limits = c(0, 50))

plot
```

```{r , echo = FALSE, warning=FALSE, message = FALSE}

optimal_q <- uniroot(function(x) CMg(x) - RMg(x), 
                     c(6,15))
```

- Agora podemos calcular o ponto onde o lucro é maximizado, ou seja, a quantidade ótima é `r optimal_q$root` e o preço ótimo será: `r demanda(optimal_q$root)`

---

# 

Desta forma, o lucro será igual à área em cinza.

```{r dpi = 300, fig.width=8, fig.height=4, echo = FALSE, warning=FALSE, message = FALSE}

plot+
  geom_rect(aes(xmin=0, xmax=optimal_q$root, 
                ymin=15, 
                ymax=demanda(optimal_q$root)),
            fill = "gray", color = "gray",
            alpha=0.02)
```

---

class: center, middle

# Fim do Apêndice

Prof. Mauricio Uriona Maldonado
